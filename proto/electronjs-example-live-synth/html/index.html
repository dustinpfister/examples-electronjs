<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title> Live Synth </title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>

    <div class="wrap_main" >
        <h1>Hello World</h1>
<script type="module">

// started working with this:
// https://stackoverflow.com/questions/67342004/how-to-continuously-generate-raw-audio-samples-in-javascript-using-the-web-audio
const blob = new Blob(
    [`
        class MyProcessor extends AudioWorkletProcessor {

            constructor(){
                super();
                this.i_sample = 0;
                this.amp = 1;
                this.count = 0;
                this.st = new Date();
            }

            process(inputList, outputs, parameters) {

                //this.a_sec = this.count % 344.53125 / 344.53125;
                //this.a_pitch = 80 * this.a_sec % 1;


                for (const output of outputs) {
                    for (const channelData of output) {
                        const len = channelData.length;
                        for (let i = 0; i < len; i += 1) {

this.i_sample += 1;

const a_sec = this.i_sample % 44100 / 44100;

const a = a_sec * 80 % 1;


                            //const a = this.a_pitch;
                            //const amp = this.amp;
                            channelData[i] = Math.sin(Math.PI * 2 * a) * 1;
                        }
                    }
                }
                this.count += 1;

                if(this.count % 345 === 0){

//const now = new Date();
//const secs = (now - this.st) / 1000;
//console.log( secs, (this.count / 344.53125).toFixed(3) );

                }

                return true;
            }
        }
        registerProcessor('my-processor', MyProcessor);
    `],
    { type: 'application/javascript' }
);
const url = URL.createObjectURL(blob);

const audioContext = new AudioContext();

await audioContext.audioWorklet.addModule(url);

//audioContext.audioWorklet.addModule(url);

const myAudioWorkletNode = new AudioWorkletNode(audioContext, 'my-processor');

myAudioWorkletNode.connect(audioContext.destination);


//console.log(audioContext);
//console.log(myAudioWorkletNode);



</script>


    </div>

  </body>
</html>